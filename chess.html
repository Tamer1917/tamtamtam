function isValidMove(fromRow, fromCol, toRow, toCol) {
    const piece = initialBoard[fromRow][fromCol];
    const targetPiece = initialBoard[toRow][toCol];

    // التأكد من أن الحركة ليست إلى مربع يحتوي على قطعة من نفس اللون
    if (targetPiece && isPieceOfCurrentPlayer(targetPiece)) {
        return false;
    }

    switch (piece.toLowerCase()) {
        case 'p': // الجندي
            // الجندي يتحرك للأمام بمقدار مربع واحد أو مربعين في حال لم يتحرك بعد
            if (currentPlayer === 'white') {
                if (fromRow === 1 && toRow === fromRow + 2 && fromCol === toCol && !initialBoard[toRow][toCol]) {
                    return true; // حركة أولى للجندي الأبيض
                }
                if (toRow === fromRow + 1 && fromCol === toCol && !targetPiece) {
                    return true; // حركة للأمام لجندي أبيض
                }
                // الهجوم للأمام بزاوية 45 درجة
                if (toRow === fromRow + 1 && (toCol === fromCol - 1 || toCol === fromCol + 1) && targetPiece) {
                    return true; // أخذ الجندي الأبيض
                }
            } else {
                if (fromRow === 6 && toRow === fromRow - 2 && fromCol === toCol && !initialBoard[toRow][toCol]) {
                    return true; // حركة أولى للجندي الأسود
                }
                if (toRow === fromRow - 1 && fromCol === toCol && !targetPiece) {
                    return true; // حركة للأمام لجندي أسود
                }
                // الهجوم للأمام بزاوية 45 درجة
                if (toRow === fromRow - 1 && (toCol === fromCol - 1 || toCol === fromCol + 1) && targetPiece) {
                    return true; // أخذ الجندي الأسود
                }
            }
            break;

        case 'r': // القلعة
            // القلعة تتحرك أفقيًا أو عموديًا فقط
            if (fromRow === toRow || fromCol === toCol) {
                return true;
            }
            break;

        case 'n': // الحصان
            // الحصان يتحرك على شكل "L"
            const rowDiff = Math.abs(fromRow - toRow);
            const colDiff = Math.abs(fromCol - toCol);
            if ((rowDiff === 2 && colDiff === 1) || (rowDiff === 1 && colDiff === 2)) {
                return true;
            }
            break;

        case 'b': // الفيل
            // الفيل يتحرك قطريًا فقط
            if (Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol)) {
                return true;
            }
            break;

        case 'q': // الملكة
            // الملكة تتحرك أفقيًا، عموديًا، أو قطريًا
            if (fromRow === toRow || fromCol === toCol || Math.abs(fromRow - toRow) === Math.abs(fromCol - toCol)) {
                return true;
            }
            break;

        case 'k': // الملك
            // الملك يتحرك مربعًا واحدًا في أي اتجاه
            if (Math.abs(fromRow - toRow) <= 1 && Math.abs(fromCol - toCol) <= 1) {
                return true;
            }
            break;

        default:
            return false;
    }
    return false;
}
